<?php

/**
 * Test class for GateKeeper.
 * Generated by PHPUnit on 2011-10-04 at 23:07:18.
 */
class GateKeeperTest extends PHPUnit_Framework_TestCase {

	private $userAccess = array(1, 10, 52, 56, 199);

	private function assertHasAccessLoggedIn($expected, $array) {
		$this->login();
		$this->assertHasAccess($expected, $array);
	}

	private function assertHasAccessLoggedOut($expected, $array) {
		$this->logout();
		$this->assertHasAccess($expected, $array);
	}

	private function assertHasAccess($expected, $array) {
		$news = new News;
		$news->access = $array;
		$news->save();

		$actual = GateKeeper::hasAccess("news", $news->id);
		$this->assertEquals($expected, $actual);
	}

	private function login() {
		$user = new User;
		$user->username = "a" . rand(0, 1000000);
		$user->firstName = "TestCase";
		$user->lastName = "TestCase";
		$user->member = "true";

		$user->setAccess($this->userAccess);
		$user->save();

		$userIdentity = new InnsidaIdentity($user->id); // Sigurd
		$userIdentity->authenticate();
		Yii::app()->user->login($userIdentity);
	}

	private function logout() {
		Yii::app()->user->logout();
	}

	public function test_hasAccess_LoggedIn_empty_true() {
		$this->assertHasAccessLoggedIn(true, array());
	}

	public function test_hasAccess_LoggedIn_someInSomeOut_false() {
		$this->assertHasAccessLoggedIn(false, array(1, 2, 3));
	}

	public function test_hasAccess_LoggedIn_someIn_true() {
		$this->assertHasAccessLoggedIn(true, array(1, 52));
	}

	public function test_hasAccess_LoggedIn_allIn_true() {
		$this->assertHasAccessLoggedIn(true, $this->userAccess);
	}

	public function test_hasAccess_LoggedIn_someOut_false() {
		$this->assertHasAccessLoggedIn(false, array(1000123, 123123));
	}

	public function test_hasAccess_LoggedIn_allInSomeOut_false() {
		$this->assertHasAccessLoggedIn(false, array_merge($this->userAccess, array(1, 2, 3, 4, 5, 6, 7, 8)));
	}

	public function test_hasAccess_LoggedOut_empty_true() {
		$this->assertHasAccessLoggedOut(true, array());
	}

	public function test_hasAccess_LoggedOut_someOut_false() {
		$this->assertHasAccessLoggedOut(false, array(1));
	}


}
